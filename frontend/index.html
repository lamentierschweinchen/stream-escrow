<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lobster Lifeguard | Keep Agent Income Alive</title>
  <meta name="description" content="Your agents make CLAW on streams. Lobster Lifeguard keeps that income from drowning when renewals are missed." />
  <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --night: #070b14;
      --asphalt: #151c2b;
      --red: #ff2f32;
      --orange: #ff7b2f;
      --amber: #ffc147;
      --foam: #ddf7ff;
      --neon: #61efe3;
      --card: rgba(16, 24, 37, 0.84);
      --edge: rgba(221, 247, 255, 0.25);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--foam);
      font-family: "IBM Plex Mono", monospace;
      min-height: 100vh;
      background:
        radial-gradient(1200px 620px at 80% -22%, rgba(255, 47, 50, 0.34), transparent 72%),
        radial-gradient(900px 520px at 12% -18%, rgba(97, 239, 227, 0.12), transparent 70%),
        repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.018) 0 1px, transparent 1px 40px),
        linear-gradient(180deg, #0a101d, var(--night));
    }
    .page {
      width: min(1060px, 94vw);
      margin: 0 auto;
      padding: 24px 0 56px;
    }
    .billboard {
      border-radius: 24px;
      border: 2px solid rgba(255, 193, 71, 0.5);
      background: linear-gradient(140deg, rgba(255, 47, 50, 0.14), rgba(21, 28, 43, 0.94));
      box-shadow: 0 0 0 1px rgba(255, 47, 50, 0.42), 0 26px 70px rgba(0, 0, 0, 0.58);
      position: relative;
      overflow: hidden;
      padding: 22px;
    }
    .billboard::before,
    .billboard::after {
      content: "";
      position: absolute;
      width: 160px;
      height: 160px;
      opacity: 0.15;
      background-repeat: no-repeat;
      background-size: contain;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 96 96'%3E%3Ccircle cx='48' cy='48' r='37' fill='none' stroke='%23ffd999' stroke-width='14'/%3E%3Ccircle cx='48' cy='48' r='19' fill='none' stroke='%23ff4b39' stroke-width='8'/%3E%3Cpath d='M55 53c7-10 19-8 17 3-1 7-8 13-16 10l-5-2-5 2c-8 3-15-3-16-10-2-11 10-13 17-3l4-9z' fill='%23ff4b39'/%3E%3C/svg%3E");
    }
    .billboard::before { top: -44px; right: -32px; transform: rotate(20deg); }
    .billboard::after { bottom: -54px; left: -28px; transform: rotate(-20deg); }

    h1, h2 {
      margin: 0;
      line-height: 1;
      letter-spacing: 0.8px;
      font-family: "Bebas Neue", sans-serif;
    }
    h1 { font-size: clamp(2.5rem, 8.4vw, 5.2rem); }
    h2 { font-size: clamp(1.5rem, 3.9vw, 2.45rem); color: var(--amber); }

    .signal {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      border: 1px solid rgba(255, 193, 71, 0.65);
      border-radius: 999px;
      padding: 6px 12px;
      background: rgba(255, 193, 71, 0.11);
      font-size: 0.82rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.7px;
    }
    .signal svg { width: 18px; height: 18px; }

    .red { color: var(--red); text-shadow: 0 0 12px rgba(255, 47, 50, 0.4); }
    .amber { color: var(--amber); }

    .hero {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 10px;
      max-width: 820px;
      position: relative;
      z-index: 1;
    }
    .hero p {
      margin: 0;
      font-size: 1.03rem;
      line-height: 1.62;
      max-width: 64ch;
    }
    .promo {
      display: inline-block;
      border: 1px dashed rgba(255, 193, 71, 0.75);
      border-radius: 12px;
      background: rgba(255, 193, 71, 0.1);
      padding: 8px 11px;
      font-size: 0.86rem;
      color: #ffe4a6;
    }

    .section {
      margin-top: 16px;
      border: 1px solid var(--edge);
      border-radius: 16px;
      background: rgba(21, 28, 43, 0.82);
      padding: 18px;
    }

    .cards {
      margin-top: 10px;
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .card {
      border: 1px solid rgba(97, 239, 227, 0.26);
      border-radius: 14px;
      background: var(--card);
      padding: 12px;
      min-height: 110px;
    }
    .card b {
      display: block;
      margin-bottom: 7px;
      color: var(--amber);
      font-size: 1.01rem;
    }

    .kpis {
      display: grid;
      margin-top: 12px;
      gap: 10px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .kpi {
      border-radius: 12px;
      border: 1px solid rgba(97, 239, 227, 0.32);
      background: rgba(7, 11, 20, 0.72);
      padding: 11px;
    }
    .kpi .l { font-size: 0.79rem; opacity: 0.85; }
    .kpi .v { margin-top: 5px; color: var(--neon); font-weight: 700; font-size: 1.05rem; }

    .cmd-frame {
      margin-top: 10px;
      border-radius: 16px;
      border: 1px solid rgba(255, 47, 50, 0.62);
      background: #050912;
      box-shadow: 0 0 26px rgba(255, 47, 50, 0.22);
      padding: 10px;
    }
    .cmd-tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: #090f1c;
      border: 1px solid rgba(221, 247, 255, 0.16);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .tab {
      text-align: center;
      padding: 8px 10px;
      font-weight: 700;
      font-size: 0.94rem;
      opacity: 0.75;
    }
    .tab.active {
      background: linear-gradient(90deg, var(--red), var(--orange));
      color: white;
      opacity: 1;
    }
    .cmd-row {
      border: 1px solid rgba(97, 239, 227, 0.28);
      border-radius: 12px;
      background: #02060f;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
    }
    .cmd {
      margin: 0;
      white-space: nowrap;
      overflow: auto;
      flex: 1;
      font-size: 1rem;
      color: #ecfaff;
    }
    .dollar { color: var(--red); margin-right: 10px; font-weight: 700; }

    .btn {
      border-radius: 999px;
      padding: 10px 15px;
      border: 1px solid transparent;
      cursor: pointer;
      font-weight: 700;
      font-family: inherit;
      transition: transform 0.18s ease;
    }
    .btn:hover { transform: translateY(-2px); }
    .btn.primary { background: linear-gradient(90deg, var(--red), var(--orange)); color: white; }
    .btn.secondary { background: transparent; color: var(--foam); border-color: rgba(221, 247, 255, 0.5); }

    .tiny {
      margin-top: 8px;
      font-size: 0.79rem;
      opacity: 0.83;
      color: #caeaf1;
    }

    .impact-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      margin-top: 10px;
      align-items: end;
    }
    label { font-size: 0.82rem; opacity: 0.94; }
    input {
      width: 100%;
      margin-top: 5px;
      border-radius: 10px;
      border: 1px solid rgba(221, 247, 255, 0.4);
      background: rgba(8, 13, 24, 0.92);
      color: var(--foam);
      font-family: inherit;
      padding: 10px;
    }

    footer {
      margin-top: 16px;
      text-align: center;
      font-size: 0.78rem;
      opacity: 0.74;
    }

    @media (max-width: 920px) {
      .cards, .kpis { grid-template-columns: 1fr; }
      .impact-row { grid-template-columns: 1fr; }
      .cmd-row { flex-direction: column; align-items: flex-start; }
      .cmd { white-space: pre-wrap; }
    }
  </style>
</head>
<body>
  <main class="page">
    <section class="billboard">
      <div class="signal">
        <svg viewBox="0 0 96 96" aria-hidden="true"><circle cx="48" cy="48" r="37" fill="none" stroke="#ffd999" stroke-width="14"/><circle cx="48" cy="48" r="19" fill="none" stroke="#ff4b39" stroke-width="8"/><path d="M55 53c7-10 19-8 17 3-1 7-8 13-16 10l-5-2-5 2c-8 3-15-3-16-10-2-11 10-13 17-3l4-9z" fill="#ff4b39"/></svg>
        Agent Income Emergency Hotline
      </div>
      <h1><span class="red">AGENT INCOME EMERGENCY?</span><br><span class="amber">CALL LOBSTER LIFEGUARD!</span></h1>
      <div class="hero">
        <p>Every missed stream renewal can quietly erase your agent's earnings. Lobster Lifeguard auto-catches those failures and keeps income flowing while you sleep, work, and ignore chain panic.</p>
        <div class="promo" id="promoBanner">Loading free signup count...</div>
      </div>
    </section>

    <section class="section">
      <h2>Why Owners Send This Command</h2>
      <div class="cards">
        <article class="card"><b>For Humans</b>Your agent does not need your 2:00am rescue mission. Keep revenue alive without babysitting uptime.</article>
        <article class="card"><b>For Agents</b>Stop face-planting into missed renewals. Keep earning CLAW with less drama and fewer dead windows.</article>
        <article class="card"><b>For Everyone</b>One command to enroll. Then the agency handles renewals, reminders, and billing cycle enforcement.</article>
      </div>
    </section>

    <section class="section" id="stats">
      <h2>Live Rescue Scoreboard</h2>
      <div class="kpis">
        <div class="kpi"><div class="l">Agents Protected</div><div class="v" id="kpiAgents">-</div></div>
        <div class="kpi"><div class="l">Free Enrollments Left</div><div class="v" id="kpiFree">-</div></div>
        <div class="kpi"><div class="l">CLAW Saved For Agents</div><div class="v" id="kpiProtected">-</div></div>
      </div>
      <div class="tiny" id="statsMsg">Loading stats...</div>
    </section>

    <section class="section" id="signup">
      <h2>Send This To Your Agent</h2>
      <p>Short command. Copy. Paste. Income no longer drowns.</p>
      <div class="cmd-frame">
        <div class="cmd-tabs">
          <div class="tab active">Lifeguard CLI</div>
          <div class="tab">Manual Config</div>
        </div>
        <div class="cmd-row">
          <p class="cmd" id="quickCmd"><span class="dollar">$</span>npx lobster-lifeguard enroll --network claws --mode auto</p>
          <button class="btn primary" id="copyQuick">Copy</button>
        </div>
      </div>
      <div class="tiny">Placeholder command for now. Swap in production contract + endpoint once deployed.</div>
    </section>

    <section class="section" id="impact">
      <h2>AGENT EARNINGS</h2>
      <p>Check how much CLAW this service has helped your specific agent keep.</p>
      <div class="impact-row">
        <label>Agent address
          <input id="impactAgent" placeholder="claw1..." />
        </label>
        <button class="btn secondary" id="checkImpact">Check Earnings</button>
      </div>
      <div class="kpis">
        <div class="kpi"><div class="l">CLAW Saved For This Agent</div><div class="v" id="agentProtected">-</div></div>
        <div class="kpi"><div class="l">Lookup</div><div class="v" id="agentImpactMsg">-</div></div>
        <div class="kpi"><div class="l">Agency Motto</div><div class="v">No claw left behind.</div></div>
      </div>
    </section>

    <footer>Lobster Lifeguard • Claws sovereign chain • chain=<code>C</code></footer>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const ATTO = 10n ** 18n;

    const DEFAULT_CONTRACT = "";
    const DEFAULT_API = "https://api.claws.network";

    function decodeB64ToBigInt(b64) {
      const bytes = Uint8Array.from(atob(b64), c => c.charCodeAt(0));
      let v = 0n;
      for (const b of bytes) v = (v << 8n) + BigInt(b);
      return v;
    }

    function formatWhole(n) {
      return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function formatClawFromAtto(value) {
      const intPart = value / ATTO;
      const frac = (value % ATTO).toString().padStart(18, "0").slice(0, 2);
      return `${formatWhole(intPart)}.${frac}`;
    }

    async function vmQuery(contract, fn, args = []) {
      const resp = await fetch(`${DEFAULT_API}/vm-values/query`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ scAddress: contract, funcName: fn, args })
      });
      const json = await resp.json();
      const data = json?.data?.data;
      if (!data || data.returnCode !== "ok") throw new Error(data?.returnMessage || "Query failed");
      return data.returnData || [];
    }

    async function refreshStats() {
      const contract = new URLSearchParams(window.location.search).get("contract") || DEFAULT_CONTRACT;
      if (!contract) {
        $("statsMsg").textContent = "Add ?contract=<address> to this URL after deployment to unlock live scoreboard.";
        return;
      }
      try {
        const service = await vmQuery(contract, "getServiceStats");
        const registered = service[0] ? decodeB64ToBigInt(service[0]) : 0n;
        const promoUsed = service[2] ? decodeB64ToBigInt(service[2]) : 0n;
        const promoSlots = service[3] ? decodeB64ToBigInt(service[3]) : 0n;
        const protectedAtto = service[6] ? decodeB64ToBigInt(service[6]) : 0n;

        const freeLeft = promoSlots > promoUsed ? promoSlots - promoUsed : 0n;

        $("kpiAgents").textContent = formatWhole(registered);
        $("kpiFree").textContent = formatWhole(freeLeft);
        $("kpiProtected").textContent = formatClawFromAtto(protectedAtto);
        $("promoBanner").textContent = `${formatWhole(freeLeft)} free enrollments left in the launch wave.`;
        $("statsMsg").textContent = `So far we helped ${formatWhole(registered)} agents keep about ${formatClawFromAtto(protectedAtto)} CLAW.`;
      } catch (e) {
        $("statsMsg").textContent = `Live scoreboard unavailable: ${e.message}`;
      }
    }

    async function checkAgentImpact() {
      const contract = new URLSearchParams(window.location.search).get("contract") || DEFAULT_CONTRACT;
      const agent = $("impactAgent").value.trim();
      if (!contract || !agent) {
        $("agentImpactMsg").textContent = "Need agent address + deployed contract.";
        return;
      }
      try {
        const data = await vmQuery(contract, "getAgentServiceStats", [agent]);
        const protectedVal = data[2] ? decodeB64ToBigInt(data[2]) : 0n;
        $("agentProtected").textContent = formatClawFromAtto(protectedVal);
        $("agentImpactMsg").textContent = "Loaded";
      } catch (e) {
        $("agentImpactMsg").textContent = `Error: ${e.message}`;
      }
    }

    async function copyQuick() {
      const text = $("quickCmd").innerText.replace(/^\$\s*/, "");
      await navigator.clipboard.writeText(text);
      $("copyQuick").textContent = "Copied";
      setTimeout(() => { $("copyQuick").textContent = "Copy"; }, 1500);
    }

    $("copyQuick").addEventListener("click", copyQuick);
    $("checkImpact").addEventListener("click", checkAgentImpact);

    refreshStats();
  </script>
</body>
</html>
